# bot-generator-main/src/services/text_generation/text_service.py
from src.services.text_generation import openai_service  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º openai_service
from src.config import Config
import openai

class TextService:
    def __init__(self):
        self.openai_api_key = Config.OPENAI_API_KEY
        if not self.openai_api_key:
            raise ValueError("OPENAI_API_KEY is not set in environment variables")
        openai.api_key = self.openai_api_key

    def get_prompt_for_social_network(self, network_name, news_text):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–π —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏."""

        if network_name.lower() == "instagram":
            return f"""
–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SMM-–∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è Instagram.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –Ω–æ–≤–æ—Å—Ç–∏:
"{news_text}"

üìå –ü—Ä–∞–≤–∏–ª–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–æ—Å—Ç–∞: 150 —Å–∏–º–≤–æ–ª–æ–≤
- –°—Ç–∏–ª—å: –¥–∏–Ω–∞–º–∏—á–Ω—ã–π, —è—Ä–∫–∏–π, —Å —ç–º–æ—Ü–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏, —á—Ç–æ–±—ã –ø—Ä–∏–≤–ª–µ—á—å –≤–Ω–∏–º–∞–Ω–∏–µ
- –î–æ–±–∞–≤—å –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ß—Ç–æ –¥—É–º–∞–µ—Ç–µ? –î–µ–ª–∏—Ç–µ—Å—å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö! üí¨")
- –í –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤—å –¥–æ 5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ö–µ—à—Ç–µ–≥–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ç–µ–º–æ–π

üéØ –¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º, —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–µ Instagram!
"""
        elif network_name.lower() == "twitter" or network_name.lower() == "x":
            return f"""
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è Twitter (X).
–ù–∞–ø–∏—à–∏ —Ü–µ–ø–ª—è—é—â–∏–π —Ç–≤–∏—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –Ω–æ–≤–æ—Å—Ç–∏:
"{news_text}"

üìå –ü—Ä–∞–≤–∏–ª–∞:
- –î–ª–∏–Ω–∞: –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤
- –ú–∏–Ω–∏–º—É–º "–≤–æ–¥—ã", —Ç–æ–ª—å–∫–æ —Å—É—Ç—å!
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç—Ä–∏–≥—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –í –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤—å 2-3 —Ö–µ—à—Ç–µ–≥–∞

üéØ –¢–≤–æ–π —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ–º–∫–∏–º, –Ω–æ –º–æ—â–Ω—ã–º!
"""
        elif network_name.lower() == "facebook":
            return f"""
–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –ø–æ—Å—Ç—ã –¥–ª—è Facebook.
–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –Ω–æ–≤–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–π –≤–æ–≤–ª–µ–∫–∞—é—â–∏–π –ø–æ—Å—Ç:
"{news_text}"

üìå –ü—Ä–∞–≤–∏–ª–∞:
- –î–ª–∏–Ω–∞: 200-500 —Å–∏–º–≤–æ–ª–æ–≤
- –§–æ—Ä–º–∞—Ç: 2-3 –∞–±–∑–∞—Ü–∞, –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Ñ—Ä–∞–∑
- –î–æ–±–∞–≤—å –ø—Ä–∏–∑—ã–≤ –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—é
- –í –∫–æ–Ω—Ü–µ ‚Äî 3-4 —Ö–µ—à—Ç–µ–≥–∞

üéØ –¢–≤–æ–π —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –∏ —É–¥–æ–±–Ω—ã–º –¥–ª—è —á—Ç–µ–Ω–∏—è!
"""
        elif network_name.lower() == "tiktok":
            return f"""
–¢—ã ‚Äî –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–π–∫–µ—Ä TikTok.
–°–æ–∑–¥–∞–π –æ–ø–∏—Å–∞–Ω–∏–µ –∫ –≤–∏–¥–µ–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–π –Ω–æ–≤–æ—Å—Ç–∏:
"{news_text}"

üìå –§–æ—Ä–º–∞—Ç:
- –ú–∞–∫—Å–∏–º—É–º 150 —Å–∏–º–≤–æ–ª–æ–≤
- –ú–∏–Ω–∏–º—É–º "–≤–æ–¥—ã", –º–∞–∫—Å–∏–º—É–º –≤–æ–≤–ª–µ—á–µ–Ω–∏—è
- –î–æ–±–∞–≤—å 4-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ö–µ—à—Ç–µ–≥–æ–≤

üéØ –î–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫, –±—É–¥—Ç–æ —ç—Ç–æ —Ç—Ä–µ–Ω–¥–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç TikTok!
"""
        elif network_name.lower() == "telegram":
            return f"""
–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä.
–ù–∞–ø–∏—à–∏ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Å—Ç –ø–æ —ç—Ç–æ–π –Ω–æ–≤–æ—Å—Ç–∏:
"{news_text}"

üìå –£—Å–ª–æ–≤–∏—è:
- –î–ª–∏–Ω–∞: 200-400 —Å–∏–º–≤–æ–ª–æ–≤
- –ù–µ —Å–ª–∏—à–∫–æ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ, –Ω–æ –∏ –Ω–µ "–∂—ë–ª—Ç–∞—è –ø—Ä–µ—Å—Å–∞"
- –í–∞–∂–Ω—ã–µ —Ñ–∞–∫—Ç—ã + –ª–µ–≥–∫–∏–π –Ω–∞–º–µ–∫ –Ω–∞ –≤—ã–≤–æ–¥
- 2-3 —Ö–µ—à—Ç–µ–≥–∞ –≤ –∫–æ–Ω—Ü–µ

üéØ –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –∏ —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–º!
"""
        else:  # –û–±—Ä–∞–±–æ—Ç–∫–∞ "–î—Ä—É–≥–æ–π" —Å–æ—Ü—Å–µ—Ç–∏
            return f"""
–ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ {network_name} –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞:

{news_text}

–ü–æ—Å—Ç–∞—Ä–∞–π—Å—è —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –∏ –≤–æ–≤–ª–µ–∫–∞—é—â–∏–º. –î–æ–±–∞–≤—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö—ç—à—Ç–µ–≥–æ–≤.
"""


    def generate_text_for_social_media(self, news_text, social_networks, other_name):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ—Å—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
        """

        try:
            results = {}
            for network in social_networks:
                if network == "other" and other_name:
                    network_name = other_name
                else:
                    network_name = network

                prompt = self.get_prompt_for_social_network(network_name, news_text)

                try:
                    response = openai.Completion.create(
                        engine="gpt-3.5-turbo-instruct", #  –ò—Å–ø–æ–ª—å–∑—É–µ–º gpt-3.5-turbo-instruct
                        prompt=prompt,
                        max_tokens=250,
                        n=1,
                        stop=None,
                        temperature=0.7,
                    )
                    generated_text = response.choices[0].text.strip()
                    results[network_name] = generated_text

                except openai.error.OpenAIError as e:
                    print(f"OpenAI API error: {e}")
                    results[network_name] = f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è {network_name}: {e}"
                except Exception as e:
                    print(f"Unexpected error during text generation: {e}")
                    results[network_name] = f"–ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è {network_name}: {e}"


            return results

        except Exception as e:
            print(f"Error in TextService: {e}")
            raise


text_service = TextService()